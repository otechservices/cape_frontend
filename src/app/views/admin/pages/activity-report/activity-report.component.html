    <!--breadcrumb-->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-5">
        <div class="breadcrumb-title pe-3">CAPE </div>
        <div class="ps-3">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 p-0">
              <li class="breadcrumb-item"><a routerLink="/admin/dashboard"><i class="bx bx-home-alt"></i></a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">Rapports d'activité</li>
            </ol>
          </nav>
        </div>
      
      </div>
    <ng-container *ngIf="!showPreview"  class="container">
        <ng-container *ngIf="role =='cape'">
            <div class="row mb-3">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header cape-bg-blue text-white">
                            <h6 class="text-white">Liste des rapports d'activité</h6>
                          </div>
                        <div class="card-body">
                            <div class="d-flex mb-5 " *ngIf="buttonsPermission">
                                <button *ngIf="role=='cape'" type="button" class="btn btn-primary btn-sm me-3" (click)="add(addContent)">Ajouter un rapport d'activité</button>
        
                                <button *ngIf="buttonsPermission.show"  (click)="show(showContent)" type="button" class="btn btn-outline-primary btn-sm  me-3">
                                     <span>Consulter</span></button>
                                     <button *ngIf="buttonsPermission.edit && role=='cape'" (click)="edit(editContent)" type="button"  class="btn btn-outline-warning btn-sm  me-3">
                                        Editer</button>
                                        <button *ngIf="buttonsPermission.delete && role=='cape'" (click)="delete()" type="button" class="btn btn-outline-danger btn-sm  me-3">
                                            Supprimer</button>
                                        <button *ngIf="buttonsPermission.transission && role=='cape'" (click)="send()" type="button" class="btn btn-outline-success btn-sm  me-3">
                                            Transmettre</button>
                          
                               
                            </div>
            
                                    <p>{{data.length}} élément(s)</p>
                                    <div class="table-responsive">
                                    <table class="table" >
                                        <thead class="">
                                            <tr>
                                                <th style="width: 10px;">#</th>
                                                <th>Description</th>
                                                <th>Statut</th>
                                                <th>Transmis</th>
                                                <th>Fichier</th>
                                    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let d of data ">
                                                <td>
                                                    <div class="form-check mb-2">
                                                        <input (click)="checked(d)" class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                    
                                                    </div>
                                                </td>
                                                <td>{{d.description}}</td>
                                                <td>
                                                    <span [ngClass]="{
                                                        'p-1 bg-secondary  text-white rounded':d.status==0,
                                                        'p-1 bg-success  text-white rounded':d.status==1,
                                                        'p-1 bg-danger  text-white rounded':d.status==2,
                                                        'p-1 bg-warning  text-white rounded':d.status==3
                                                    }">
                                                    {{getStatus(d.status)}}
                                                </span>
                                                </td>
                                                <td>
                                                    <span [ngClass]="{
                                                        'p-1 bg-secondary  text-white rounded':d.is_transmitted==0,
                                                        'p-1 bg-success  text-white rounded':d.is_transmitted==1
                                                    }">
                                                    {{d.is_transmitted?"Oui":"Non"}}
                                                </span>
                                                </td>
                                                <td>
                                                    <div class="d-flex justify-content-between">
                                                        <button class="btn btn-outline-primary btn-sm" (click)="showFile(d.activity_report_filename,d)">Ouvrir le rapport d'activité</button>
                                                        <button class="btn btn-outline-primary btn-sm" (click)="showFile(d.financial_report_filename,d)">Ouvrir le rapport financier</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        
                                        </tbody>
                                    </table>
                                    </div>
            
                        </div><!-- end card -->
                    </div>
                    <!-- end col -->
                </div>
                <!-- end col -->
            </div>

            <div class="row mb-5">
                <div class="col-lg-12">
                    <div class="card">
                      <div class="card-header cape-bg-blue text-white">
                        <h6 class="text-white">Instructions sur le rapport d'activité</h6>
                      </div>
                        <div class="card-body">

                         
                                    <p>{{activity_report_responses.length}} élément(s)</p>
                                    <div class="table-responsive">
                                    <table class="table">
                                        <thead class="">
                                            <tr>
                                                <th style="width: 10px;">#</th>
                                                <th>Instruction</th>
                                    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let d of activity_report_responses ">
                                                <td>
                                                    <div class="form-check mb-2">
                                                        <input (click)="checked3(d)" class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                    
                                                    </div>
                                                </td>
                                                <td>{{d.instruction}}</td>
                                               
                                            </tr>
                                        
                                        </tbody>
                                    </table>
                                    </div>
            
                        </div><!-- end card -->
                    </div>
                    <!-- end col -->
                </div>
                <!-- end col -->
            </div>
        </ng-container>
        <ng-container *ngIf="role !='cape'">
            <div class="row mb-3">
                <div class="col-lg-12">
                    <div class="card">
                      <div class="card-header cape-bg-blue text-white">
                        <h6 class="text-white">Liste des capes ayant déposé des rapports d'activité</h6>
                      </div>
                        <div class="card-body">
                                    <p>{{data.length}} élément(s)</p>
                                    <div class="table-responsive">
                                    <table class="table" >
                                        <thead class="">
                                            <tr>
                                                <th style="width: 10px;">#</th>
                                                <th>Type CAPE</th>
                                                <th>Dénomination</th>
                                                <th>Nombres d'enfants</th>
                                                <th>Effectif du personnel</th>
                                    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let d of data ">
                                                <td>
                                                    <div class="form-check mb-2">
                                                        <input (click)="checked(d)" class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                    
                                                    </div>
                                                </td>
                                                <td>{{d.requete?.type_cape?.name}}</td>
                                                <td>{{d.requete?.name}} </td>
                                                <td>{{d.residents_count}} </td>
                                                <td>{{d.staffs_count}} </td>
                                            </tr>
                                        
                                        </tbody>
                                    </table>
                                    </div>
            
                        </div><!-- end card -->
                    </div>
                    <!-- end col -->
                </div>
                <!-- end col -->
            </div>
            <div class="row mb-3">
                <div class="col-lg-12">
                    <div class="card">
                      <div class="card-header cape-bg-blue ">
                        <h6 class="text-white">Rapports d'activité</h6>
                      </div>
                        <div class="card-body">

                            <div *ngIf="role == 'ministre'" class="d-flex">
                                <button *ngIf="buttonsPermission2.ok"   (click)="setStatus(1)" type="button"  class="btn btn-outline-success btn-sm  me-3">
                                    Valider</button>
                                <button  *ngIf="buttonsPermission2.ok" (click)="setStatus(2)" type="button"  class="btn btn-outline-danger btn-sm  me-3">
                                    Rejeter</button>
                            </div>
                                    <p>{{activity_reports.length}} élément(s)</p>
                                    <div class="table-responsive">
                                    <table class="table" >
                                        <thead class="">
                                            <tr>
                                                <th style="width: 10px;">#</th>
                                                <th>Description</th>
                                                <th>Statut</th>
                                                <th>Transmis</th>
                                                <th>Fichier</th>
                                    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let d of activity_reports ">
                                                <td>
                                                    <div class="form-check mb-2">
                                                        <input (click)="checked2(d)" class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                    
                                                    </div>
                                                </td>
                                                <td>{{d.description}}</td>
                                                <td>
                                                    <span [ngClass]="{
                                                        'p-1 bg-secondary  text-white rounded':d.status==0,
                                                        'p-1 bg-success  text-white rounded':d.status==1,
                                                        'p-1 bg-danger  text-white rounded':d.status==2,
                                                        'p-1 bg-warning  text-white rounded':d.status==3
                                                    }">
                                                    {{getStatus(d.status)}}
                                                </span>
                                                </td>
                                                <td>
                                                    <span [ngClass]="{
                                                        'p-1 bg-secondary  text-white rounded':d.is_transmitted==0,
                                                        'p-1 bg-success  text-white rounded':d.is_transmitted==1
                                                    }">
                                                    {{d.is_transmitted?"Oui":"Non"}}
                                                </span>
                                                </td>
                                                <td>
                                                    <div class="d-flex justify-content-between">
                                                        <button class="btn btn-outline-primary btn-sm" (click)="showFile(d.activity_report_filename,d)">Ouvrir le rapport d'activité</button>
                                                        <button class="btn btn-outline-primary btn-sm" (click)="showFile(d.financial_report_filename,d)">Ouvrir le rapport financier</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        
                                        </tbody>
                                    </table>
                                    </div>
            
                        </div><!-- end card -->
                    </div>
                    <!-- end col -->
                </div>
                <!-- end col -->
            </div>
            <div class="row mb-5">
                <div class="col-lg-12">
                    <div class="card">
                      <div class="card-header cape-bg-blue text-white">
                        <h6 class="text-white">Instructions sur le rapport d'activité</h6>
                      </div>
                        <div class="card-body">

                            <div *ngIf="role=='ministre' " class="d-flex justify-content-between">
                                <button  type="button" class="btn btn-primary btn-sm me-3" (click)="add2(addObsContent)">Ajouter une observation</button>

                                    <button *ngIf="activity_report_responses.length>0"  (click)="edit2(editObsContent)" type="button"  class="btn btn-outline-warning btn-sm  me-3">
                                       Editer</button>
                                       <button *ngIf="activity_report_responses.length>0"   (click)="deleteObs()" type="button" class="btn btn-outline-danger btn-sm  me-3">
                                           Supprimer</button>
                            </div>
                                    <p>{{activity_report_responses.length}} élément(s)</p>
                                    <div class="table-responsive">
                                    <table class="table">
                                        <thead class="">
                                            <tr>
                                                <th style="width: 10px;">#</th>
                                                <th>Instruction</th>
                                    
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let d of activity_report_responses ">
                                                <td>
                                                    <div class="form-check mb-2">
                                                        <input (click)="checked3(d)" class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                                    
                                                    </div>
                                                </td>
                                                <td>{{d.instruction}}</td>
                                               
                                            </tr>
                                        
                                        </tbody>
                                    </table>
                                    </div>
            
                        </div><!-- end card -->
                    </div>
                    <!-- end col -->
                </div>
                <!-- end col -->
            </div>
        </ng-container>
    
    </ng-container>

    
  <ng-container *ngIf="showPreview"  class="container">
    <div class="d-flex justify-content-around">
        <button class="btn btn-dark mb-3 " (click)="back()">Fermer le visualiseur</button>
        <!--button  *ngIf="!showResponseFilePreview"  class="btn btn-success mb-3 " [disabled]="!activeobsPanel"  (click)="openWindow(contentTemplateAmendement)">Faire des observations</!--button-->

    </div>


 
    <object [data]="url" type="application/pdf" width="100%" height="600px"></object>
</ng-container>


    <ng-template #addContent let-c="close" let-d="dismiss">
        <form #addForm="ngForm" (ngSubmit)="store(addForm.value)">
        <div class="modal-header bg-secondary">
          <h6 class="modal-title text-white" id="modal-basic-title">Enregistrer un rapport d'activité</h6>
          <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
        </div>
        <div class="modal-body" >
            <div class="row mb-3" >
          
                <div class=" form-goup col-12 mb-3">
                    <label for="">Description <span class="text-danger ml-2">(*)</span></label>
                    <textarea name="description" class="form-control" ngModel required></textarea>
                </div>
                <div class=" form-goup col-12 mb-3">
                    <label for="">Rapport d'activité <span class="text-danger ml-2">(*)</span></label>
                    <input type="file" class="form-control" (change)="upload($event,0)">
                </div>
                <div class=" form-goup col-12 mb-3">
                    <label for="">Rapport financier <span class="text-danger ml-2">(*)</span></label>
                    <input type="file" class="form-control" (change)="upload($event,1)">
                </div>
                
    
            </div>
           
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-outline-dark" [disabled]="addForm.invalid"  >Enregistrer <app-loading [isVisible]="loading"></app-loading></button>
        </div>
    </form>
      </ng-template>
    
      <ng-template #editContent let-c="close" let-d="dismiss">
        <form #editForm="ngForm" (ngSubmit)="update(editForm.value)">
        <div class="modal-header bg-secondary">
          <h6 class="modal-title text-white" id="modal-basic-title">Modifier un rapport d'activité</h6>
          <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
        </div>
        <div class="modal-body" >
            <div class="row mb-3" >
          
                <div class=" form-goup col-12 mb-3">
                    <label for="">Description <span class="text-danger ml-2">(*)</span></label>
                    <textarea name="description" class="form-control" [(ngModel)]="selected_data.description" required></textarea>
                </div>
                <div class=" form-goup col-12 mb-3">
                    <label for="">Rapport d'activité </label>
                    <input type="file" class="form-control" (change)="upload($event,0)">
                </div>
                <div class=" form-goup col-12 mb-3">
                    <label for="">Rapport financier </label>
                    <input type="file" class="form-control" (change)="upload($event,1)">
                </div>
                
    
            </div>
           
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-outline-dark" [disabled]="editForm.invalid" >Sauvegarder <app-loading [isVisible]="loading"></app-loading></button>
        </div>
    </form>
      </ng-template>
    
      <ng-template #showContent let-c="close" let-d="dismiss">
        <div class="modal-header bg-secondary">
            <h6 class="modal-title text-white" id="modal-basic-title">Détails des informations</h6>
            <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
          </div>
    
          <div class="modal-body">
             
                <dl>
                    <dt class="fw-medium">Description</dt>
                    <dd >{{selected_data.description}} </dd>
                </dl>
               <dl>
                <dt>Fichier</dt>
                <dd>
                    <div class="d-flex justify-content-between">
                        <button class="btn btn-outline-primary btn-sm" (click)="showFile(selected_data.activity_report_filename)">Ouvrir le rapport d'activité</button>
                        <button class="btn btn-outline-primary btn-sm" (click)="showFile(selected_data.financial_report_filename)">Ouvrir le rapport financier</button>
                    </div>
                </dd>
               </dl>
          </div>
    </ng-template>



    
    <ng-template #addObsContent let-c="close" let-d="dismiss">
        <form #addForm="ngForm" (ngSubmit)="storeObs(addForm.value)">
        <div class="modal-header bg-secondary">
          <h6 class="modal-title text-white" id="modal-basic-title">Enregistrer une instruction</h6>
          <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
        </div>
        <div class="modal-body" >
            <div class="row mb-3" >
          
                <div class=" form-goup col-12 mb-3">
                    <label for="">Instruction <span class="text-danger ml-2">(*)</span></label>
                    <textarea name="instruction" class="form-control" ngModel required></textarea>
                </div>
              
            </div>
           
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-outline-dark" [disabled]="addForm.invalid"  >Enregistrer <app-loading [isVisible]="loading"></app-loading></button>
        </div>
    </form>
      </ng-template>
    
      <ng-template #editObsContent let-c="close" let-d="dismiss">
        <form #editForm="ngForm" (ngSubmit)="updateObs(editForm.value)">
        <div class="modal-header bg-secondary">
          <h6 class="modal-title text-white" id="modal-basic-title">Modifier une instruction</h6>
          <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
        </div>
        <div class="modal-body" >
            <div class="row mb-3" >
          
                <div class=" form-goup col-12 mb-3">
                    <label for="">Instruction <span class="text-danger ml-2">(*)</span></label>
                    <textarea name="instruction" class="form-control" [(ngModel)]="selected_data3.instruction" required></textarea>
                </div>
             
            </div>
           
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-outline-dark" [disabled]="editForm.invalid" >Sauvegarder <app-loading [isVisible]="loading"></app-loading></button>
        </div>
    </form>
      </ng-template>