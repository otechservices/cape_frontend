<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-5">
    <div class="breadcrumb-title pe-3">CAPE </div>
    <div class="ps-3">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0 p-0">
          <li class="breadcrumb-item"><a routerLink="/admin/dashboard"><i class="bx bx-home-alt"></i></a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">Liste des CAPE à autoriser</li>
        </ol>
      </nav>
    </div>
  </div>

   <div class="row">
    <div class="col-lg-12">
        <div class="card">
          
            <div class="card-body">
             <div class="d-flex">
                <button  (click)="add(addContent)" type="button" class="btn btn-outline-success btn-sm  me-3">
                    Décider</button>
                <button  (click)="authorized()" *ngIf="canClosed" type="button" class="btn btn-outline-danger btn-sm  me-3">
                    Clôturer</button>
             </div>
                        <p>{{data.length}} élément(s)</p>
                        <div class="table-responsive">
                        <table class="table" >
                            <thead class="">
                                <tr>
                                    <th style="width: 10px;">#</th>
                                    <th>Cape</th>
                                    <th>Décision du comité</th>
                                    <th>Décision du ministre</th>
                                    <th>Action</th>
                        
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let d of data ">
                                    <td>

                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" [checked]="d.is_authorized" >

                                          </div>
                                        <!--div class="form-check mb-2">
                                            <input (click)="checked(d)" class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                                        
                                        </!--div-->
                                    </td>
                                    <td>{{d.name}}</td>
                                    <td>
                                        <span *ngIf="d.has_agreemant==1" class="p-1 bg-warning text-white"> Accord donné sous réserve</span>
                                        <span *ngIf="d.has_agreemant==2" class="p-1 bg-success text-white"> Accord donné</span>
                                    </td>
                                    <td>
                                        <span *ngIf="d.is_authorized==0" class="p-1 bg-warning text-white"> Autorisation mise en attente</span>
                                        <span *ngIf="d.is_authorized==1" class="p-1 bg-success text-white"> Autorisation accordée</span>
                                    </td>
                                    <td>
                                        <a  class="btn btn-sm btn-primary" [routerLink]="'/admin/session-request-show/'+ d.code">Ouvrir le dossier </a>

                                    </td>
                
                                </tr>
                            
                            </tbody>
                        </table>
                        </div>

            </div><!-- end card -->
        </div>
        <!-- end col -->
    </div>
    <!-- end col -->
</div>



<ng-template #addContent let-c="close" let-d="dismiss">
    <form #addForm="ngForm" (ngSubmit)="setStatus()">
    <div class="modal-header bg-secondary">
      <h6 class="modal-title text-white" id="modal-basic-title">Décision finale</h6>
      <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
    </div>
    <div class="modal-body" >
        <div class="row mb-3" >
            <div class="form-group">
                <label for="">Décision</label>
                <select name="decision" class="form-control" [(ngModel)]="decision" required >
                    <option value="1">Favorable</option>
                    <option value="0">Mise en attente</option>
                </select>
            </div>
         
      
                <!--div class="bg-light mb-1" *ngFor="let d of decisions; let i=index">
                        <p>{{d.observation}}</p>
               
               </!--div-->
               <ng-container *ngIf="decision==0">
                <div class=" form-group col-12 mb-3">
                    <label for="">Observation <span class="text-danger ml-2">(*)</span></label>
                    <textarea name="observation" class="form-control" ngModel required cols="30" rows="3"></textarea>
                </div>
                <hr>
                <h6>Liste des recommandations</h6>
               <form #refForm="ngForm" (ngSubmit)="onAdd(refForm.value,refForm)">
               <div class="input-group mb-3">
                <input type="text" class="form-control" name="observation" required ngModel>
                <button [disabled]="refForm.invalid" class="btn btn-sm btn-outline-secondary" type="submit" id="button-addon2">Ajouter une recommandation</button>
              </div>
            </form>
        </ng-container>

        </div>
       
    </div>
    <div class="modal-footer">
      <button type="submit" class="btn btn-outline-dark" [disabled]="addForm.invalid"  >Vadlier ma décision <app-loading [isVisible]="loading"></app-loading></button>
    </div>
</form>
  </ng-template>